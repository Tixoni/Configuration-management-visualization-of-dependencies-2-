# Dependency Visualizer - Инструмент визуализации графа зависимостей

## Описание проекта

Инструмент для анализа и визуализации графа зависимостей пакетов без использования готовых менеджеров пакетов. Поддерживает NPM, PyPI и UPPERCASE репозитории.

## Архитектура проекта

### Основные модули и их назначение

### 1. **main.py** - Главный запускаемый файл

**Назначение**: Точка входа в приложение, инициализация и запуск визуализатора.

**Методы**:
- `main()` - основная функция запуска приложения
- Проверяет наличие конфигурационного файла
- Обрабатывает аргументы командной строки

### 2. **dependency_visualizer.py** - Основной класс визуализатора

**Назначение**: Координация всего процесса анализа и визуализации зависимостей.

**Ключевые методы**:
- `load_config()` - загрузка конфигурации из YAML
- `_validate_config()` - валидация параметров конфигурации
- `analyze_real_dependencies()` - запуск анализа зависимостей
- `display_ascii_tree()` - отображение дерева в консоли
- `save_tree_to_file()` - сохранение графа в файл
- `run()` - основной метод выполнения

### 3. **dependency_analyzer.py** - Анализатор зависимостей

**Назначение**: Рекурсивный анализ зависимостей пакетов.

**Ключевые методы**:
- `analyze_package()` - рекурсивный анализ пакета и его зависимостей
- `_should_include_in_graph()` - умная фильтрация пакетов при построении графа
- Определяет тип репозитория (npm/pypi/uppercase)
- Обрабатывает максимальную глубину анализа
- Применяет рекурсивную фильтрацию пакетов

### 4. **repository_client.py** - Клиент для работы с репозиториями

**Назначение**: Получение информации о пакетах из различных репозиториев.

**Ключевые методы**:
- `detect_repository_type()` - определение типа репозитория по URL
- `fetch_npm_package_info()` - получение информации о NPM пакетах
- `fetch_pypi_package_info()` - получение информации о Python пакетах
- `fetch_uppercase_package_info()` - получение информации о UPPERCASE пакетах
- `extract_dependencies()` - извлечение зависимостей из информации о пакете
- `_normalize_package_name()` - нормализация имен пакетов
- `_extract_python_version()` - парсинг версий зависимостей Python

### 5. **uppercase_repository.py** - Поддержка UPPERCASE репозиториев

**Назначение**: Работа с пользовательскими репозиториями в UPPERCASE формате.

**Ключевые методы**:
- `_load_repository_graph()` - загрузка графа репозитория из файла
- `_parse_repository_graph()` - парсинг специального формата графа
- `get_package()` - получение информации о пакете
- `_validate_uppercase_name()` - валидация имен пакетов в UPPERCASE

### 6. **yaml_parser.py** - Парсер конфигурации

**Назначение**: Чтение и парсинг YAML конфигурации без внешних библиотек.

**Ключевые методы**:
- `parse_yaml_file()` - чтение и парсинг YAML файла
- `_parse_yaml_content()` - парсинг содержимого YAML
- `_parse_value()` - определение типов значений

### 7. **output_capture.py** - Захват вывода

**Назначение**: Логирование всего вывода в консоль в файл.

**Ключевые методы**:
- `start_capture()` - начало захвата вывода
- `stop_capture()` - остановка захвата вывода

### 8. **test_repository.py** - Тестовый репозиторий

**Назначение**: Работа с локальными тестовыми данными для офлайн-тестирования.

**Ключевые методы**:
- `_load_packages()` - загрузка пакетов из JSON файлов
- `get_package()` - получение информации о пакете
- `package_exists()` - проверка существования пакета

### 9. Вспомогательные классы ошибок:
- **config_error.py** - `ConfigError` для ошибок конфигурации
- **network_error.py** - `NetworkError` для ошибок сети

## Как программа получает зависимости пакетов

### Алгоритм получения зависимостей:

1. **Определение типа репозитория**
    - Анализирует URL для определения типа (npm/pypi/uppercase/local)
    - Поддерживает NPM registry, PyPI и пользовательские UPPERCASE репозитории

2. **Получение информации о пакете**
    - **NPM**: HTTP запрос к `https://registry.npmjs.org/{package_name}`
    - **PyPI**: HTTP запрос к `https://pypi.org/pypi/{package_name}/json`
    - **UPPERCASE**: Чтение из текстового файла с графом зависимостей
    - Использует встроенные библиотеки `urllib.request` и `json`

3. **Извлечение зависимостей**
    - **NPM**: Анализирует поле `dependencies` из JSON ответа
    - **PyPI**: Анализирует поле `requires_dist` из информации о пакете
    - **UPPERCASE**: Извлекает зависимости из графа репозитория
    - Парсит строки зависимостей Python для извлечения версий

4. **Рекурсивный анализ**
    - Для каждой зависимости повторяет процесс
    - Учитывает максимальную глубину анализа
    - Применяет умную фильтрацию по подстроке

5. **Обработка ошибок**
    - SSL ошибки обходятся через отключение проверки сертификатов
    - Таймауты и сетевые ошибки обрабатываются с повторными попытками
    - Некорректные версии нормализуются

### Особенности реализации:

- **Без использования менеджеров пакетов**: Все запросы выполняются через HTTP API репозиториев
- **Нормализация версий**: Автоматическое разрешение версий типа "latest"
- **Кеширование**: Избегание повторного анализа одних и тех же пакетов
- **Умная фильтрация**: Рекурсивная фильтрация, показывающая полные пути к целевым пакетам
- **Поддержка UPPERCASE**: Работа с пользовательскими репозиториями в специальном формате
- **Логирование**: Подробное логирование всего процесса выполнения

## Новые возможности 3 этапа

### Поддержка UPPERCASE репозиториев

Программа теперь поддерживает пользовательские репозитории в формате UPPERCASE:

```txt
PACKAGEA
  PACKAGEB
  PACKAGEC
PACKAGEB
  PACKAGED
```

**Формат файла**:
- Имена пакетов в UPPERCASE (только большие латинские буквы, цифры и подчеркивания)
- Зависимости указываются с отступом под именем пакета
- Поддерживаются циклические зависимости

### Улучшенная система фильтрации

Новая логика фильтрации показывает полные пути к целевым пакетам:

- **Рекурсивная проверка**: Пакет включается в граф если он или любой из его потомков проходит фильтр
- **Сохраняет контекст**: Показывает полные цепочки зависимостей, ведущие к целевым пакетам
- **Гибкая настройка**: Фильтр применяется при построении графа, а не при извлечении зависимостей

### Обработка циклических зависимостей

Программа корректно обрабатывает циклические зависимости в UPPERCASE репозиториях, отображая полные циклы в графе.

## Использование

```bash
python main.py config.yaml
```

Пример конфигурации для UPPERCASE репозитория:
```yaml
package:
  name: "PACKAGEA"
  version: "1.0.0"
  repo_url: "test_uppercase_repo.txt"
max_depth: 3
filter: "PACKAGEE"
output_file: "dependency_graph.txt"
```